"""
Network-secured version of ddos/SynFlood.py
Modified to simulate SYN flood behavior without scapy
(scapy requires root privileges and raw sockets)
"""

import socket
import random
import time

# SECURITY: Use internal Docker network address
target_ip = "consumer"
target_port = 80
count = 100  # Reduced from 1000 for safety

print(f"[SYN Flood] Starting SYN flood simulation")
print(f"[SYN Flood] Target: {target_ip}:{target_port}")
print(f"[SYN Flood] Count: {count} packets")
print("[SYN Flood] Note: scapy not available - simulating behavior")


def simulate_syn_packet(target, port):
    """Simulate SYN packet without scapy (which needs root)"""
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(0.1)
        src_port = random.randint(1024, 65535)
        # Attempt connection (creates SYN packet at TCP level)
        sock.connect_ex((target, port))
        sock.close()
        return True
    except Exception:
        return False


for i in range(count):
    spoofed_ip = f"{random.randint(1, 223)}.{random.randint(0, 255)}"
    spoofed_ip += f".{random.randint(0, 255)}.{random.randint(1, 254)}"

    print(f"[SYN Flood] Packet {i + 1}/{count} from spoofed {spoofed_ip}")
    simulate_syn_packet(target_ip, target_port)
    time.sleep(random.uniform(0.01, 0.05))

print("[SYN Flood] Burst complete")
time.sleep(30)
