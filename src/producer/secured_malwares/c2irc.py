"""
Network-secured version of BotNet/C2IRC.py
Modified to use internal Docker network (consumer service on IRC port)
"""

import socket
import time
import random

# SECURITY: Use internal Docker network address
server = "consumer"
port = 6667  # IRC port (consumer won't listen, will fail safely)
nickname = f"bot{random.randint(1000, 9999)}"
channel = "#botnet"

print(f"[C2IRC] Starting IRC C2 simulation as {nickname}")
print(f"[C2IRC] Target: {server}:{port}")

try:
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(5)
    sock.connect((server, port))
    sock.sendall(f"NICK {nickname}\r\n".encode())
    sock.sendall(f"USER {nickname} 0 * :realname\r\n".encode())
    time.sleep(2)
    sock.sendall(f"JOIN {channel}\r\n".encode())

    while True:
        sock.sendall(f"PRIVMSG {channel} :ping\r\n".encode())
        data = sock.recv(4096).decode()
        print(f"[C2IRC] recv: {data}")
        time.sleep(random.randint(20, 120))
except Exception as e:
    print(f"[C2IRC] Connection failed (expected): {e}")
    print("[C2IRC] Simulating IRC C2 locally without actual connection")
    # Continue simulation without real connection
    while True:
        print(f"[C2IRC] {nickname} -> PRIVMSG {channel} :ping")
        time.sleep(random.randint(20, 120))
